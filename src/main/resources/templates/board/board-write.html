<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ko">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/main.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/board/board-write.css}">
    <link href="/assets/img/favicon.png" rel="icon">
    <title>에이콘테이너 : 글 작성하기</title>
    <script src="https://cdn.tiny.cloud/1/ko0z729tparrg6hwynh2s6yoesmpc2oph6uc8qt2vshio6m9/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="/js/common/tinyMCEConfig.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let selectFiles = [];
            let fileChoiceButton = document.getElementById('fileChoiceBtn');
            let fileInput = document.getElementById('fileInput');
            let backListButton = document.getElementById('backListBtn');
            let fileListArea = document.getElementById('fileListArea');

            fileChoiceButton.addEventListener('click', function (event) {
                fileInput.click();
                event.preventDefault();
            })

            fileInput.addEventListener('change', function (event) {
                updateFileSelect(this.files);
                this.value = '';
                event.preventDefault();
            })

            function updateFileSelect(files) {
                let isDuplicate = false;

                Array.from(files).forEach(file => {
                    if (!selectFiles.some(f => f.name === file.name)) {
                        selectFiles.push(file);
                    } else {
                        isDuplicate = true;
                    }
                });

                if (isDuplicate) {
                    alert("중복된 파일은 업로드 할 수 없습니다.");
                }
                displayFiles();
            }

            function displayFiles() {
                fileListArea.innerHTML = '';

                if (selectFiles.length > 5) {
                    alert("파일은 최대 5개까지 업로드할 수 있습니다.");
                    selectFiles = selectFiles.slice(0, 5);
                    displayFiles();
                    return;
                }

                selectFiles.forEach((file, index) => {
                    const fileEntry = document.createElement('div');
                    fileEntry.classList.add('file-entry');

                    const fileNameSpan = document.createElement('span');
                    fileNameSpan.textContent = file.name;
                    fileEntry.appendChild(fileNameSpan);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = '삭제';
                    deleteButton.classList.add('delete-btn');
                    deleteButton.addEventListener('click', function (event) {
                        event.preventDefault();
                        removeFile(index);
                    });
                    fileEntry.appendChild(deleteButton);

                    fileListArea.appendChild(fileEntry);
                });
            }

            function removeFile(index) {
                selectFiles.splice(index, 1);
                displayFiles();
            }

            backListButton.addEventListener('click', function () {
                window.location.href = "/board/list";
            });

            document.getElementById('writeForm').addEventListener('submit', function () {

            });

        });
    </script>
</head>
<body>
<div sec:authorize="isAnonymous()">
    <div th:replace="~{fragments/header:: header}"></div>
</div>
<div sec:authorize="hasAnyRole('ROLE_USER')">
    <div th:replace="~{fragments/header_user :: header}"></div>
</div>
<div sec:authorize="hasAnyRole('ROLE_OWNER')">
    <div th:replace="~{fragments/header_owner :: header}"></div>
</div>
<main id="main">
    <div class="breadcrumbs d-flex align-items-center" style="background-image: url('/assets/img/breadcrumbs-bg.jpg');">
    </div>
    <div class="board-write-form">
        <form id="writeForm">
            <div class="form-group">
                <label for="boardTitle">제목</label>
                <input type="text" id="boardTitle" name="title">
            </div>

            <div class="form-row">
                <div class="form-group half">
                    <label for="boardWrite">작성자</label>
                    <input type="text" id="boardWrite" name="author">
                </div>
                <div class="form-group half">
                    <label for="boardPassword">비밀번호</label>
                    <input type="password" id="boardPassword">
                </div>
            </div>

            <div class="form-group">
                <label for="boardContents">내용</label>
                <textarea id="boardContents"></textarea>
            </div>

            <div class="form-group">
                <label for="fileInput">파일첨부</label>
                <button type="button" id="fileChoiceBtn">파일 선택하기</button>
                <input type="file" id="fileInput" name="boardFile" multiple style="display: none;"/>
                <div id="fileListArea">
                    <!-- 파일 목록을 표시할 공간 -->
                </div>
            </div>

            <div class="form-group button-container">
                <input type="button" id="backListBtn" value="목록">
                <input type="button" id="writeBtn" value="작성하기">
            </div>
        </form>
    </div>
</main>
</body>
</html>